<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Abrir Spotify</title>
  <meta name="theme-color" content="#121212">
  <style>
    :root { --bg:#121212; --fg:#fff; --accent:#1DB954; }
    html,body{height:100%} body{margin:0;background:var(--bg);color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,sans-serif;
    display:flex;align-items:center;justify-content:center;text-align:center;padding:2rem}
    h1{margin:0 0 .5rem 0} p{opacity:.85;margin:.5rem 0 1.25rem}
    a.btn{display:inline-block;padding:1rem 2rem;border-radius:999px;
      background:var(--accent);color:#fff;text-decoration:none;font-size:1.15rem}
    small{display:block;opacity:.6;margin-top:1rem}
  </style>
</head>
<body>
  <main>
    <h1>üéµ Abrir playlist en Spotify</h1>
    <p>Toca el bot√≥n. En JoyUI/MIUI puede aparecer un aviso de seguridad, es normal.</p>
    <a id="open" class="btn" href="#">Abrir en la app</a>
    <small id="alt"></small>
  </main>

  <script>
    // --- CONFIG ---
    const DEFAULT_PLAYLIST = "PLAYLIST_ID"; // <-- c√°mbialo si quieres un valor por defecto
    // Permite pasar ?p=<id> en la URL para no editar el archivo
    const params = new URLSearchParams(location.search);
    const id = params.get("p") || DEFAULT_PLAYLIST;

    // Construcci√≥n de enlaces
    const web = `https://open.spotify.com/playlist/${id}`;
    const spotifyScheme = `spotify://playlist/${id}`;
    // Dos variantes de intent por compatibilidad MIUI/JoyUI
    const intentHttps =
      `intent://open.spotify.com/playlist/${id}` +
      `#Intent;scheme=https;package=com.spotify.music;` +
      `S.browser_fallback_url=${encodeURIComponent(web)};end`;
    const intentSpotifyScheme =
      `intent://playlist/${id}` +
      `#Intent;scheme=spotify;package=com.spotify.music;` +
      `S.browser_fallback_url=${encodeURIComponent(web)};end`;

    // Detecci√≥n r√°pida
    const ua = navigator.userAgent || "";
    const isAndroid = /Android/i.test(ua);
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    const isMIUI = /MiuiBrowser|Mi\s?Browser|XiaoMi|BlackShark/i.test(ua);

    // Mostrar alternativa visible por si todo falla
    const alt = document.getElementById("alt");
    alt.innerHTML = `Si no se abre, <a href="${web}" rel="noopener">abre la versi√≥n web</a>.`;

    // Estrategia de apertura al TOCAR el bot√≥n (gesto del usuario)
    document.getElementById("open").addEventListener("click", (e) => {
      e.preventDefault();

      // 1) En iOS, el esquema nativo suele ser lo m√°s fiable
      if (isIOS) {
        try { window.location.href = spotifyScheme; } catch(_) {}
        setTimeout(() => { window.location.href = web; }, 1200);
        return;
      }

      // 2) En Android JoyUI/MIUI probamos en este orden:
      //    a) esquema nativo spotify:// (muchas veces evita el prompt)
      //    b) intent con scheme=spotify
      //    c) intent con scheme=https
      //    d) fallback web
      if (isAndroid) {
        // a)
        try { window.location.href = spotifyScheme; } catch(_) {}
        // b) tras un breve delay
        setTimeout(() => {
          try { window.location.href = intentSpotifyScheme; } catch(_) {}
        }, 250);
        // c)
        setTimeout(() => {
          try { window.location.href = intentHttps; } catch(_) {}
        }, 600);
        // d) fallback web
        setTimeout(() => { window.location.href = web; }, 1400);
        return;
      }

      // 3) Escritorio u otros: abre web
      window.location.href = web;
    });

    // Opcional: si quieres que, al abrir por NFC, aparezca el bot√≥n ya enfocado
    // para que s√≥lo tengas que tocar ‚Äúenter‚Äù:
    document.getElementById("open").focus();
  </script>
</body>
</html>
